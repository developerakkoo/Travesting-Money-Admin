<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/folder/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Mutual Fund Portfolio ðŸ“Š</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="addMutualFund()" color="success">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Summary Stats -->
  <ion-grid fixed>
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <ion-icon name="trending-up" color="primary"></ion-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{getTotalMutualFunds()}}</div>
                <div class="stat-label">Total Funds</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="12" size-md="6">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <ion-icon name="pie-chart" color="success"></ion-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">
                  {{getTotalWeight() | number:'1.1-1'}}%
                </div>
                <div class="stat-label">Total Weight</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Chart Section -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Portfolio Weight Distribution ðŸ“Š</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="chart-container">
        <div class="chart-wrapper">
          <canvas #weightChart height="300"></canvas>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Search and Filters -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Search & Filter Mutual Funds</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="8">
            <ion-searchbar
              [(ngModel)]="searchTerm"
              (ionInput)="onSearchChange()"
              placeholder="Search by fund name, category, or role..."
              show-clear-button="focus"
            ></ion-searchbar>
          </ion-col>
          <ion-col size="12" size-md="4">
            <ion-button fill="outline" (click)="clearFilters()" color="medium">
              <ion-icon name="refresh" slot="start"></ion-icon>
              Clear Filters
            </ion-button>
            <ion-button fill="solid" (click)="addMutualFund()" color="success">
              <ion-icon name="add" slot="start"></ion-icon>
              Add Fund
            </ion-button>
            <ion-button
              fill="outline"
              (click)="bulkImportMutualFunds()"
              color="warning"
            >
              <ion-icon name="download" slot="start"></ion-icon>
              Bulk Import
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Mutual Funds Table -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        Mutual Funds ({{filteredMutualFunds.length}} found)
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="table-container">
        <table class="funds-table">
          <thead>
            <tr>
              <th>Sr. No</th>
              <th>Fund Name</th>
              <th>Category</th>
              <th>Portfolio Weight</th>
              <th>Expense Ratio</th>
              <th>Role</th>
              <th>Created At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fund of getPaginatedMutualFunds(); let i = index">
              <td>{{(currentPage - 1) * itemsPerPage + i + 1}}</td>
              <td>
                <div class="fund-name">{{fund.fundName}}</div>
              </td>
              <td>
                <ion-chip size="small" color="primary"
                  >{{fund.category}}</ion-chip
                >
              </td>
              <td>
                <div class="percentage-display">
                  <ion-badge
                    [color]="fund.portfolioWeight > 10 ? 'success' : 'warning'"
                  >
                    {{fund.portfolioWeight | number:'1.1-1'}}%
                  </ion-badge>
                </div>
              </td>
              <td>
                <div class="percentage-display">
                  <ion-badge color="tertiary">
                    {{fund.expenseRatio | number:'1.2-2'}}%
                  </ion-badge>
                </div>
              </td>
              <td>
                <ion-chip size="small" color="secondary"
                  >{{fund.role}}</ion-chip
                >
              </td>
              <td>{{formatDate(fund.createdAt)}}</td>
              <td>
                <ion-button
                  fill="clear"
                  size="small"
                  color="primary"
                  (click)="editMutualFund(fund)"
                  title="Edit Mutual Fund"
                >
                  <ion-icon name="create" slot="icon-only"></ion-icon>
                </ion-button>
                <ion-button
                  fill="clear"
                  size="small"
                  color="danger"
                  (click)="deleteMutualFund(fund)"
                  title="Delete Mutual Fund"
                >
                  <ion-icon name="trash" slot="icon-only"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredMutualFunds.length === 0">
          <ion-icon name="pie-chart-outline"></ion-icon>
          <h3>No Mutual Funds Found</h3>
          <p>Try adjusting your search criteria or add your first mutual fund</p>
          <ion-button fill="outline" (click)="addMutualFund()">
            <ion-icon name="add" slot="start"></ion-icon>
            Add First Fund
          </ion-button>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="getTotalPages() > 1">
        <ion-button
          fill="clear"
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
        >
          <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
        </ion-button>

        <span class="page-info">
          Page {{currentPage}} of {{getTotalPages()}}
        </span>

        <ion-button
          fill="clear"
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === getTotalPages()"
        >
          <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>

